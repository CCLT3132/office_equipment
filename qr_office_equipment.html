<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code System</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
  <div class="max-w-3xl mx-auto">
    <!-- ‡πÅ‡∏ó‡πá‡∏ö -->
    <div class="flex gap-2 mb-4">
      <button onclick="showTab('create')" id="tabCreate" class="flex-1 py-3 px-6 bg-white text-indigo-600 font-semibold rounded-xl shadow-lg">
        ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code
      </button>
      <button onclick="showTab('view')" id="tabView" class="flex-1 py-3 px-6 bg-white/50 text-gray-600 font-semibold rounded-xl">
        ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      </button>
    </div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á QR -->
    <div id="createTab" class="bg-white rounded-2xl shadow-xl p-6">
      <div class="flex items-center gap-3 mb-6">
        <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
        <h1 class="text-2xl font-bold text-gray-800">‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code</h1>
      </div>

      <div class="space-y-3">
        <input id="code" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
        
        <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
        
        <input id="location" placeholder="Location" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
        
        <textarea id="note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>

        <div class="space-y-2">
          <label class="text-sm font-medium text-gray-700">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL ‡∏à‡∏≤‡∏Å Google Drive)</label>
          <p class="text-xs text-gray-500 mb-2">üí° ‡∏ß‡∏≤‡∏á URL ‡∏à‡∏≤‡∏Å Google Drive ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
          <input id="img1" placeholder="URL ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
          <input id="img2" placeholder="URL ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
          <input id="img3" placeholder="URL ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
          <input id="img4" placeholder="URL ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
        </div>

        <button onclick="generateQR()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">
          ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code
        </button>
      </div>

      <div id="result" class="mt-6 text-center hidden">
        <img id="qrImg" src="" alt="QR Code" class="mx-auto border-4 border-indigo-100 rounded-lg shadow-lg">
        <div class="mt-4 space-y-3">
          <button onclick="downloadQR()" class="inline-block bg-indigo-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-indigo-700 transition-colors">
            ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î QR Code
          </button>
          <div class="p-3 bg-gray-50 rounded-lg">
            <p class="text-xs text-gray-600 mb-1">URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ä‡∏£‡πå:</p>
            <input id="shareUrl" readonly class="w-full text-xs p-2 border rounded bg-white" onclick="this.select()">
            <button onclick="copyUrl()" class="mt-2 text-xs bg-gray-200 hover:bg-gray-300 px-4 py-1 rounded transition-colors">
              üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <div id="viewTab" class="bg-white rounded-2xl shadow-xl p-6 hidden">
      <div class="flex items-center gap-3 mb-6">
        <svg class="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        <h1 class="text-2xl font-bold text-gray-800">‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h1>
      </div>

      <div id="dataDisplay" class="hidden">
        <div class="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl p-6 space-y-4">
          <div class="border-b border-emerald-200 pb-3">
            <label class="text-xs font-semibold text-emerald-700 uppercase tracking-wide">‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
            <p id="displayCode" class="text-xl font-bold text-gray-800 mt-1"></p>
          </div>

          <div class="border-b border-emerald-200 pb-3">
            <label class="text-xs font-semibold text-emerald-700 uppercase tracking-wide">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
            <p id="displayName" class="text-lg text-gray-800 mt-1"></p>
          </div>

          <div class="border-b border-emerald-200 pb-3">
            <label class="text-xs font-semibold text-emerald-700 uppercase tracking-wide">Location</label>
            <p id="displayLocation" class="text-lg text-gray-800 mt-1"></p>
          </div>

          <div class="border-b border-emerald-200 pb-3">
            <label class="text-xs font-semibold text-emerald-700 uppercase tracking-wide">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
            <p id="displayNote" class="text-gray-700 mt-1"></p>
          </div>

          <div>
            <label class="text-xs font-semibold text-emerald-700 uppercase tracking-wide mb-3 block">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
            <div id="displayImages" class="space-y-4"></div>
          </div>
        </div>
      </div>

      <div id="noData" class="text-center py-12">
        <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
        </svg>
        <p class="text-gray-600 text-lg font-medium">‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
        <p class="text-gray-500 text-sm mt-2">‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ QR Code ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô</p>
      </div>
    </div>
  </div>

  <script>
    let currentQRData = null;

    // ‡πÅ‡∏õ‡∏•‡∏á Google Drive URL ‡πÄ‡∏õ‡πá‡∏ô Direct Link
    function convertGDriveUrl(url) {
      if (!url) return url;
      
      // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô URL ‡∏à‡∏≤‡∏Å Google Drive
      const match = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
      if (match) {
        return `https://drive.google.com/uc?export=view&id=${match[1]}`;
      }
      
      // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô URL ‡πÅ‡∏ö‡∏ö‡πÅ‡∏ä‡∏£‡πå
      const shareMatch = url.match(/id=([a-zA-Z0-9_-]+)/);
      if (shareMatch && url.includes('drive.google.com')) {
        return `https://drive.google.com/uc?export=view&id=${shareMatch[1]}`;
      }
      
      return url;
    }

    function showTab(tab) {
      if (tab === 'create') {
        document.getElementById('createTab').classList.remove('hidden');
        document.getElementById('viewTab').classList.add('hidden');
        document.getElementById('tabCreate').className = 'flex-1 py-3 px-6 bg-white text-indigo-600 font-semibold rounded-xl shadow-lg';
        document.getElementById('tabView').className = 'flex-1 py-3 px-6 bg-white/50 text-gray-600 font-semibold rounded-xl';
      } else {
        document.getElementById('createTab').classList.add('hidden');
        document.getElementById('viewTab').classList.remove('hidden');
        document.getElementById('tabCreate').className = 'flex-1 py-3 px-6 bg-white/50 text-gray-600 font-semibold rounded-xl';
        document.getElementById('tabView').className = 'flex-1 py-3 px-6 bg-white text-emerald-600 font-semibold rounded-xl shadow-lg';
      }
    }

    async function generateQR() {
      const code = document.getElementById('code').value;
      const name = document.getElementById('name').value;
      const location = document.getElementById('location').value;
      const note = document.getElementById('note').value;
      
      const imgs = [
        convertGDriveUrl(document.getElementById('img1').value),
        convertGDriveUrl(document.getElementById('img2').value),
        convertGDriveUrl(document.getElementById('img3').value),
        convertGDriveUrl(document.getElementById('img4').value)
      ].filter(img => img);

      const data = `‡∏£‡∏´‡∏±‡∏™:${code}\n‡∏ä‡∏∑‡πà‡∏≠:${name}\n‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á:${location}\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:${note}\n‡∏£‡∏π‡∏õ:${imgs.join(',')}`;
      const baseUrl = window.location.href.split('?')[0];
      const fullUrl = `${baseUrl}?data=${encodeURIComponent(data)}`;
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(fullUrl)}`;
      
      document.getElementById('qrImg').src = qrUrl;
      document.getElementById('shareUrl').value = fullUrl;
      document.getElementById('result').classList.remove('hidden');
      
      currentQRData = { qrUrl, code, fullUrl };
    }

    async function downloadQR() {
      if (!currentQRData) return;
      
      try {
        // ‡∏î‡∏∂‡∏á QR ‡∏°‡∏≤
        const response = await fetch(currentQRData.qrUrl);
        const blob = await response.blob();
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á canvas ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏î‡∏Ç‡∏≠‡∏ö
        const img = new Image();
        const reader = new FileReader();
        
        reader.onload = (e) => {
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const padding = 20;
            
            canvas.width = img.width + (padding * 2);
            canvas.height = img.height + (padding * 2);
            
            // ‡∏ß‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ‡∏ß‡∏≤‡∏î‡∏Ç‡∏≠‡∏ö
            ctx.strokeStyle = '#818cf8';
            ctx.lineWidth = 8;
            ctx.strokeRect(4, 4, canvas.width - 8, canvas.height - 8);
            
            // ‡∏ß‡∏≤‡∏î QR ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á
            ctx.drawImage(img, padding, padding);
            
            // ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
            canvas.toBlob((finalBlob) => {
              const url = URL.createObjectURL(finalBlob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `qr_${currentQRData.code || 'code'}.png`;
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
            });
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(blob);
      } catch (e) {
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
      }
    }

    function copyUrl() {
      const urlInput = document.getElementById('shareUrl');
      urlInput.select();
      urlInput.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(urlInput.value).then(() => {
        alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡πÅ‡∏•‡πâ‡∏ß!');
      });
    }

    function loadDataFromUrl() {
      const urlParams = new URLSearchParams(window.location.search);
      const data = urlParams.get('data');
      
      if (data) {
        showTab('view');
        const decoded = decodeURIComponent(data);
        const lines = decoded.split('\n');
        const info = {};
        
        lines.forEach(line => {
          const [key, ...valueParts] = line.split(':');
          const value = valueParts.join(':');
          if (key.includes('‡∏£‡∏´‡∏±‡∏™')) info.code = value;
          else if (key.includes('‡∏ä‡∏∑‡πà‡∏≠')) info.name = value;
          else if (key.includes('‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á')) info.location = value;
          else if (key.includes('‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏')) info.note = value;
          else if (key.includes('‡∏£‡∏π‡∏õ')) info.imgs = value.split(',').filter(i => i);
        });

        document.getElementById('displayCode').textContent = info.code || '-';
        document.getElementById('displayName').textContent = info.name || '-';
        document.getElementById('displayLocation').textContent = info.location || '-';
        document.getElementById('displayNote').textContent = info.note || '-';
        
        const imgContainer = document.getElementById('displayImages');
        imgContainer.innerHTML = '';
        
        if (info.imgs && info.imgs.length > 0) {
          info.imgs.forEach((imgUrl, index) => {
            const div = document.createElement('div');
            div.className = 'rounded-lg overflow-hidden shadow-lg border-2 border-emerald-100';
            const img = document.createElement('img');
            img.src = imgUrl.trim();
            img.alt = `‡∏£‡∏π‡∏õ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ${index + 1}`;
            img.className = 'w-full h-auto object-contain bg-gray-50';
            img.style.maxHeight = '400px';
            img.onerror = function() {
              this.src = 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect fill=%22%23f3f4f6%22 width=%22400%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22 font-size=%2220%22%3E‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏î‡πâ%3C/text%3E%3C/svg%3E';
            };
            div.appendChild(img);
            imgContainer.appendChild(div);
          });
        } else {
          imgContainer.innerHTML = '<p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>';
        }

        document.getElementById('noData').classList.add('hidden');
        document.getElementById('dataDisplay').classList.remove('hidden');
      }
    }

    window.addEventListener('DOMContentLoaded', loadDataFromUrl);
  </script>
</body>
</html>