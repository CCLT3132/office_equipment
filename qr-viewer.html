<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>แสดงข้อมูลอุปกรณ์</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-4">
  <div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-xl p-6">
    <div class="flex items-center gap-3 mb-6">
      <svg class="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
      </svg>
      <h1 class="text-2xl font-bold text-gray-800">แสดงข้อมูลอุปกรณ์</h1>
    </div>

    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">วาง URL ที่มีข้อมูล</label>
      <input id="urlInput" placeholder="https://example.com?data=..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent">
      <button onclick="loadData()" class="mt-3 w-full bg-emerald-600 text-white py-3 rounded-lg font-semibold hover:bg-emerald-700 transition-colors">
        แสดงข้อมูล
      </button>
    </div>

    <div id="dataDisplay" class="hidden">
      <div class="bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl p-6 space-y-4">
        <div class="border-b border-emerald-200 pb-3">
          <label class="text-xs font-semibold text-emerald-700 uppercase tracking-wide">รหัสอุปกรณ์</label>
          <p id="displayCode" class="text-xl font-bold text-gray-800 mt-1"></p>
        </div>

        <div class="border-b border-emerald-200 pb-3">
          <label class="text-xs font-semibold text-emerald-700 uppercase tracking-wide">ชื่ออุปกรณ์</label>
          <p id="displayName" class="text-lg text-gray-800 mt-1"></p>
        </div>

        <div class="border-b border-emerald-200 pb-3">
          <label class="text-xs font-semibold text-emerald-700 uppercase tracking-wide">Location</label>
          <p id="displayLocation" class="text-lg text-gray-800 mt-1"></p>
        </div>

        <div class="border-b border-emerald-200 pb-3">
          <label class="text-xs font-semibold text-emerald-700 uppercase tracking-wide">หมายเหตุ</label>
          <p id="displayNote" class="text-gray-700 mt-1"></p>
        </div>

        <div>
          <label class="text-xs font-semibold text-emerald-700 uppercase tracking-wide mb-3 block">รูปภาพ</label>
          <div id="displayImages" class="grid grid-cols-2 gap-4"></div>
        </div>
      </div>
    </div>

    <div id="errorMsg" class="hidden mt-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700"></div>
  </div>

  <script>
    function loadData() {
      const url = document.getElementById('urlInput').value;
      const errorMsg = document.getElementById('errorMsg');
      const dataDisplay = document.getElementById('dataDisplay');
      
      errorMsg.classList.add('hidden');
      dataDisplay.classList.add('hidden');

      try {
        const urlObj = new URL(url);
        const params = new URLSearchParams(urlObj.search);
        const data = params.get('data');
        
        if (!data) {
          throw new Error('ไม่พบข้อมูลใน URL');
        }

        const decoded = decodeURIComponent(data);
        const lines = decoded.split('\n');
        const info = {};
        
        lines.forEach(line => {
          const [key, ...valueParts] = line.split(':');
          const value = valueParts.join(':');
          if (key.includes('รหัส')) info.code = value;
          else if (key.includes('ชื่อ')) info.name = value;
          else if (key.includes('ที่ตั้ง')) info.location = value;
          else if (key.includes('หมายเหตุ')) info.note = value;
          else if (key.includes('รูป')) info.imgs = value.split(',').filter(i => i);
        });

        document.getElementById('displayCode').textContent = info.code || '-';
        document.getElementById('displayName').textContent = info.name || '-';
        document.getElementById('displayLocation').textContent = info.location || '-';
        document.getElementById('displayNote').textContent = info.note || '-';
        
        const imgContainer = document.getElementById('displayImages');
        imgContainer.innerHTML = '';
        
        if (info.imgs && info.imgs.length > 0) {
          info.imgs.forEach(imgUrl => {
            const div = document.createElement('div');
            div.className = 'rounded-lg overflow-hidden shadow-md';
            div.innerHTML = `<img src="${imgUrl.trim()}" alt="รูปอุปกรณ์" class="w-full h-48 object-cover" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect fill=%22%23ddd%22 width=%22200%22 height=%22200%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3ENo Image%3C/text%3E%3C/svg%3E'">`;
            imgContainer.appendChild(div);
          });
        } else {
          imgContainer.innerHTML = '<p class="text-gray-500 col-span-2">ไม่มีรูปภาพ</p>';
        }

        dataDisplay.classList.remove('hidden');
      } catch (e) {
        errorMsg.textContent = 'เกิดข้อผิดพลาด: ' + e.message;
        errorMsg.classList.remove('hidden');
      }
    }

    // อ่านข้อมูลจาก URL โดยอัตโนมัติถ้ามี parameter
    window.addEventListener('DOMContentLoaded', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const data = urlParams.get('data');
      if (data) {
        document.getElementById('urlInput').value = window.location.href;
        loadData();
      }
    });
  </script>
</body>
</html>